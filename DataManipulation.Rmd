---
title: "GetData"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-packages, include=FALSE}
library(rvest)
library(XML)
library(RCurl)
library(tidyverse)
library(readr)
```

```{r data}
years <- seq(2010,2021)

url <- paste0("https://www.sports-reference.com/cbb/seasons/", years, 
                  "-ratings.html", sep="")

webpage <- read_html(url)

col_names <- webpage %>% 
        html_nodes(".center , .left , .right")
```

```{r kenPom}
kenPomData <- data.frame()
inputPath <- "2019Data\\" # Location for storing the data to be used as an input to the ML work.

# For training purposes, get all data before the current year. Aggregate into a single data frame.

getKenPomYearData <- function(year)
{
    theUrl <- paste0("https://kenpom.com/index.php?y=", as.character(year))
    page <- read_html(theUrl)
    tables <- page %>% html_nodes("table") %>% html_table()
    data <- as.data.frame(tables[1])

    colnames(data) <- c("Rk", "Team", "Conf", "Record", "AdjEM", "AdjO", 
         "AdjO_R", "AdjD", "AdjD_R", "AdjT", "AdjT_R",
         "Luck", "Luck_R", "SoS_AdjEM", "SoS_AdjEM_R", 
         "OppO", "OppO_R", "OppD", "OppD_R", "NC_AdjEM", "NC_AdjEM_R")
    
    data$Year = year

    return(data)
}

for (year in 2002:2019)
{
    kenPomYear <- getKenPomYearData(year)
    kenPomData <- rbind(kenPomData, kenPomYear)
}

kenPomData2021 <- getKenPomYearData(2021)

names(kenPomData2021)<-tolower(names(kenPomData2021))
# For the features needed for predicting the current year, get just the current year's data.
```

```{r cleaning}
kenPomData <- kenPomData %>%
  filter(rk != "Rk") %>%
  filter(!is.na(rk)) %>%
  filter(rk != "")

kenPomData2021 <- kenPomData2021 %>%
  filter(rk != "Rk") %>%
  filter(!is.na(rk)) %>%
  filter(rk != "")

kenPomData2021 <- kenPomData2021 %>%
  mutate(team = gsub("[.]", "", team))

kenPomData2021 <- kenPomData2021 %>%
  mutate(seed = parse_number(team)) %>%
  filter(!is.na(seed))

parse_number(kenPomData2021$team)
```


